<!DOCTYPE html>
{% load static %}
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Instyle</title>
    <link rel="stylesheet" type="text/css" href="/static/css/settings.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="/static/img/system/title-logo.png" />
  </head>
  <body>
    <header>
      <section>
        <a href="/"><p class="logo-name">Instyle</p></a>
        <div class="header-icons">
          <a href="/"><img src="/static/img/system/home-empty.svg" alt="Главная страница" title="Главная страница"></a>
          <a href="/chat"><img src="/static/img/system/chat-empty.svg" alt="Мессенджер" title="Мессенджер"></a>
          <a href="/post"><img src="/static/img/system/add-empty.svg" alt="Добавить фотографию" title="Добавить фотографию"></a>
          <a href="/recommendation"><img src="/static/img/system/compass-empty.svg" alt="Рекомендуемое" title="Рекомендуемое"></a>
          <a href="/notification"><img src="/static/img/system/notification-empty.svg" alt="Уведомления" title="Уведомления"></a>
          <a href="/user/{{user.username}}">
            {%if profile.avatar_small%}
            <img src="/static/img/small/avatar/{{user.id}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" id="upper-avatar">
            {%else%}
            <img src="/static/img/small/avatar/standard.png" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" id="upper-avatar">
            {%endif%}
        </a>   
        </div>
      </section>
    </header>
    
    
    <section class="main-section">
      <h1>Настройки</h1>

      <div class="settings-block">
        
        <form action="/settings/change-avatar" enctype="multipart/form-data" method="post">
          {% csrf_token %}
          <div class="name-section">
            <h3>Изменить аватар</h3>
          </div>
          {{form.as_p}}
          <!-- {%if profile.avatar_big%}
          <img src="/static/img/big/avatar/{{user.id}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-big-avatar" id="settings-avatar">
          {%else%}
          <img src="/static/img/big/avatar/standard.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-big-avatar" id="settings-avatar">
          {%endif%} -->
           
          <!-- <p class="paste-photo-text">Выберете фотографию с устройства</p> -->
          <!-- <input type="file" class="input__file" name="avatar" id="input_file" accept=".jpeg,.jpg"> -->
          <!-- <label for="input_file" class="input__file-button">
              <span class="input__file-button-text">Выбрать фотографию</span>
          </label> -->

          <div class="block-change">

          <button>Изменить</button>
        </form>

       
        <form action="/settings/edit-profile" method="post">
          {% csrf_token %}
          <div class="name-section">
            <img src="/static/img/system/edit.svg" alt="Профиль" title="Профиль" class="name-section-img">
            <h3>Редактировать профиль</h3>
          </div>
          
          <div class="block-change">
              <h5>Ваше имя</h5>
              <input type="text" value="{{user.name_lastname}}" name="name_lastname" required>
          </div>

          <div class="block-change">
            <h5>Ваше имя пользователя</h5>
            <input type="text" value="{{user.username}}" name="username" required>
          </div>

          <div class="block-change">
            <h5>О себе</h5>
            <textarea name="bio" value="{{profile.bio}}">{{profile.bio}}</textarea>
          </div>

           <div class="block-change">
            <h5>Ваш эл. адрес</h5>
            <input type="text" value="{{user.email}}" name="email" required>
          </div>

          <button>Изменить</button>
        </form>


        <form action="/settings/change-password" method="post">
          {% csrf_token %}
          <div class="name-section">
            <img src="/static/img/system/lock.svg" alt="Профиль" title="Профиль" class="name-section-img">
            <h3>Сменить пароль</h3>
          </div>
          
          <div class="block-change">
              <h5>Старый пароль</h5>
              <input type="password" name="old-pass" required>
          </div>

          <div class="block-change">
            <h5>Новый пароль</h5>
              <input type="password" name="new-pass" required>
          </div>

          <div class="block-change">
            <h5>Подтвердите новый пароль</h5>
              <input type="password" name="new-pass2" required>
          </div>

          <a href="/settings/forgot-password" style="color: #0095f6; font-size: 14px;">Я забыл пароль</a> <br>
          <button class="last-element">Изменить</button>
        </form>



      
        
      </div>
      <button style="margin-bottom: 20px; background:#000;" onclick="window.location='https://oauth.vk.com/authorize?client_id=51622458&redirect_uri=http://127.0.0.1:8000/post/get_vk_token&scope=photos&response_type=token'">Загрузить фото ВК</button>
      <button style="margin-bottom: 20px; background:#ff3535;" onclick="window.location='/login'">Выход</button>
      <button style="margin-bottom: 20px; background:#ff3535;" onclick="delete_acc()">Удалить аккаунт</button>
    </section>

<script src="/socket.io/socket.io.js"></script>
  <script src="/static/js/sockets.js"></script>
  <script src="/static/js/sweetalert2.all.min.js"></script>
  <script>
    const input_image = document.getElementById('input_file');
  const settings_avatar = document.getElementById('settings-avatar');

  input_image.onchange = () => {
    const [file] = input_image.files
    if (file) settings_avatar.src = URL.createObjectURL(file)
  }
  </script>

{% if messages %}
  {% for message in messages %}

  {% if message.tags == 'error' %}
    <script>
      Swal.fire({
        title: 'Ошибка!',
        text: '{{message}}',
        icon: 'error',
        confirmButtonText: 'Повторить попытку'
      })
    </script>
{% endif %}

{% if message.tags == 'success' %}
    <script>
      Swal.fire({
        title: 'Успешно',
        text: '{{message}}',
        icon: 'success',
        confirmButtonText: 'Продолжить'
      })
    </script>
{% endif %}

  {% endfor %}
{% endif %}

<script>
  function delete_acc() {
    Swal.fire({
      position: 'top',
      icon: 'warning',
      title: 'Вы действительно хотите удалить свой аккаунт без возможности восстановления?',
      confirmButtonText: 'Да',
      showCancelButton: true,
      cancelButtonText: 'Нет',
      confirmButtonColor: '#ff3535',
      cancelButtonColor: '#00cc00',
    }).then((result) => {
      if (result.isConfirmed) {
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        fetch(`${window.location.origin}/settings/delete`, {
          method: "post",
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
          },
        }).then(response => response)
          .then(result => { 
              window.location.href = `${window.location.origin}/login/`
          })
      }
      
      });
  }
</script>

  </body>
</html>