<!DOCTYPE html>
{% load static %}
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Instyle</title>
    <link rel="stylesheet" href="{% static "css/chat.css" %}" />
    <link rel="shortcut icon" type="image/x-icon"  href="{% static "img/system/title-logo.png" %}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.js"></script>
  </head>
  <body>
    <header>
      <section>
        <a href="/"><p class="logo-name">Instyle</p></a>
        <div class="header-icons">
          <a href="/"><img src="{% static "img/system/home-empty.svg" %}" alt="Главная страница" title="Главная страница"></a>
          <a href="/chat"><img src="{% static "img/system/chat-fill.svg" %}" alt="Мессенджер" title="Мессенджер"></a>
          <a href="/post"><img src="{% static "img/system/add-empty.svg" %}" alt="Добавить фотографию" title="Добавить фотографию"></a>
          <a href="/recommendation"><img src="{% static "img/system/compass-empty.svg" %}" alt="Рекомендуемое" title="Рекомендуемое"></a>
          <a href="/notification"><img src="{% static "img/system/notification-empty.svg" %}" alt="Уведомления" title="Уведомления"></a>
          <a href="/user/{{user.username}}">
            {%if profile.avatar_small%}
            <img src="/static/img/small/avatar/{{user.id}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" id="upper-avatar">
            {%else%}
            <img src="/static/img/small/avatar/standard.png" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" id="upper-avatar">
            {%endif%}
        </a>
        </div>
      </section>
    </header>
    <section class="main-section">
      <ul class="chats" id="outputChats">
        
        {%for this in chats%}
          {%if this.sender%}
          <li class="chat" id_chat="{{this.id_chat}}" username="{{this.interlocutor.username}}" id="chat" online="{{this.interlocutor.online}}" lastMessage="Вы: {{this.info.last_message_content}}">
           {%else%}
           <li class="chat" id_chat="{{this.id_chat}}" username="{{this.interlocutor.username}}" id="chat" online="{{this.interlocutor.online}}" lastMessage="{{this.info.last_message_content}}"></li>
           {%endif%} 
            {%if profile.avatar_small%}
            <img src="/static/img/small/avatar/{{user.id}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" id="upper-avatar">
            {%else%}
            <img src="/static/img/small/avatar/standard.png" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" id="upper-avatar">
            {%endif%}
               <div online="{{this.interlocutor.online}}" class="onlinePoint" id="onlinePoint" id_chat="{{this.id_chat}}" style="display:none"></div>
              <div online="{{this.interlocutor.online}}" id_chat="{{this.id_chat}}" class="inside">
                  <p id="chatName" id_chat="{{this.id_chat}}" class="lastSenderText" online="{{this.interlocutor.online}}">{{this.interlocutor.name_lastname}}</p>
                  <p id="lastMessage" id_chat="{{this.id_chat}}" class="lastMessageText" online="{{this.interlocutor.online}}">{%if this.sender%}Вы: {%endif%}{{this.info.last_message_content}}</p>
              </div>
              <div id_chat="{{this.id_chat}}" online="{{this.interlocutor.online}}">
                  <p id="time_last_message" class="time_last_message" id_chat="{{this.id_chat}}" online="{{this.interlocutor.online}}">{{this.info.last_message_time}}</p>
              </div>                             
          </li>
        {%endfor%}
        {%if not chats%}
        <p class="start-chat">Начните с кем-то общаться!</p>
        {%endif%}
      </ul>

      <div class="chatBox">
          <div class="chatInfo" id="chatInfo">
              <div class="chatInfoBlock">
                  <a href="/user/{{interlocutor.username}}" id="nameHref"><p class="chatInfoName" id="chatInfoName">{{interlocutor.name_lastname}}</p></a>
                  <div>
                      <div id="typing"></div>
                      <div class="onlineBlock"></div>
                      <p id="status" class="chatOnlineText"></p>
                  </div>
              </div>

              <a href="/user/{{interlocutor.username}}" id="imgHref">
              {%if interlocutor.avatar_small%}
                <img src="/static/img/small/avatar/{{interlocutor.id}}.jpg" alt="{{interlocutor.name_lastname}}" title="{{interlocutor.name_lastname}}" class="chatInfoImg" id="chatInfoImg" style="display: none;">
              {%else%}
                <img src="/static/img/small/avatar/standard.png" alt="{{interlocutor.name_lastname}}" title="{{interlocutor.name_lastname}}" class="chatInfoImg" id="chatInfoImg" style="display: none;">
              {%endif%}
              </a>
          </div>

          <div class="messageBox" id="messageBox">
              <ul class="outputmessages" id="outputMessages">
                {%for this in messages%}
                {%if im_sender%}
                  <li class="message own" id_message="{{this.id}}">
                {%else%}
                  <li class="message interlocutor" id_message="{{this.id}}"></li>
                {%endif%}
                      <p>{{this.content}}</p>
                      <date style="font-size:12px; color: #000">{{this.sent_date}}</date>
                  </li>
                {%endfor%}
              </ul>

                <div class="sticker-menu" id="sticker-menu" style="display: none;">
        
                </div>
          </div>

          <div class="inputBox">
              <input id="message" placeholder="Введите сообщение..." class="inputText" autocomplete="off">
              <img class="sticker-button" id="sticker-button" src='/static/img/system/sticker.svg' title="Стикеры">
              <img class="imgSend" id="send" src='/static/img/system/chat-send.svg'>
          </div>
      </div>
  </section>

  <script src="/static/js/stickers-fill.js"></script>
  <script src="//code.jquery.com/jquery-2.0.2.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/static/js/messenger_constants.js"></script>
  <script src="/static/js/sockets.js"></script>
  <script src="/static/js/messenger.js"></script>
  <script src="/static/js/parseDate.js"></script>
  <script src="/static/js/sweetalert2.all.min.js"></script>

  {%if interlocutor%}
  <script>
    outputMessages.scrollTop = outputMessages.scrollHeight
    activeConversation = 'none';
    idInterlocutor = '{{interlocutor.id}}';
    status.textContent = wasOnline('{{interlocutor.online}}')
    
  </script>
  {%endif%}

  <script>
    stickerButton.onclick = () => {
      if (stickerMenu.style.display == "none") stickerMenu.style = "display: block;"
      else stickerMenu.style = "display: none;"
    }
  </script>
  </body>
</html>